{% extends "app.html" %}

{% block app_content %}

<div class="p-0"><h3>Recent runs</h3></div>
<hr class="border border-danger border-1 opacity-50">

<!-- https://getbootstrap.com/docs/5.2/content/tables/#responsive-tables -->
<div class="table-responsive">
<table id="runs" class="table table-hover">
            <thead>
                <tr>
                    <th scope="col">Run creation time</th>
                    <th scope="col" style="width: 195px">Commit author</th>
                    <th scope="col">Repository</th>
                    <th scope="col">Hardware</th>
                    <th scope="col" class="commit-col" style="width: 65px">Commit</th>
                    <th scope="col" style="width: 150px">Commit message</th>
                    <th scope="col" class="reason-col" style="width: 80px">Reason</th>
                </tr>
            </thead>
            <tbody>
                {% for run in runs %}
                <tr>
                     <td style="white-space: nowrap;">
                         {% if run.has_errors or run.error_info %}
                             <i class="glyphicon glyphicon-exclamation-sign text-danger"
                                data-toggle="tooltip"
                                data-placement="top"
                                title="Run or some benchmarks have errors"></i>
                         {% else %}
                            <i class="glyphicon glyphicon-ok-circle text-success"></i>
                         {% endif %}
                         <a href="{{ url_for('app.run', run_id=run.id) }}">{{ run.display_timestamp }}</a>
                     </td>

                     <td>
                         <div class="table-entry">
                       {% if run.commit.author_avatar %}
                         <img src="{{ run.commit.author_avatar }}" height="30" style="border-radius: 50%;">&nbsp;
                       {% endif %}
                       {{ run.commit.author_name }}
                         </div>
                     </td>

                    <td>
                         <div class="table-entry">
                             <a href="{{ run.commit.repository }}">{{ run.commit.display_repository }}</a>
                         </div>
                    </td>

                    <td>
                         <div class="table-entry">{{ run.hardware.name }}</div>
                    </td>
                    <td>
                         <div class="table-entry">
                             <!--NOTE: enables full commit SHA search while maintaining partial SHA display for UI -->
                             <a href="{{ run.commit.url }}"> {{ run.commit.sha[:7] }}
                             <p class="hide-text">{{ run.commit.sha }}</p>
                         </a>
                         </div>
                    </td>

                    <td>
                         {% if run.commit.display_message %}
                            <div class="table-entry">{{ run.commit.display_message }}</div>
                         {% else %}
                            <div class="table-entry"></div>
                         {% endif %}
                    </td>

                    <td>
                         {% if run.reason %}
                           <div class="table-entry">{{ run.reason }}</div>
                         {% else %}
                           <div class="table-entry"></div>
                         {% endif %}
                    </td>
                </tr>
                {% endfor %}
            </tbody>
</table>
</div>

{% endblock %}


{% block scripts %}
{{super()}}
<script>
  var table = $('#runs').DataTable({
      // the default default seems to be the first item in lengthMenu.
      "lengthMenu": [ 5, 10, 50, 75, 100 ],
      // but when pageLength is also set, then _this_ is the default.
      "pageLength": 10,
      "order": [[0, 'desc']],
      // https://datatables.net/reference/option/dom
      // put `l` to the bottom
      "dom": "lfrtip",
      //"lengthMenu": [ 20, 25, 50, 75, 100 ],
      // Make "Commit" (commit hash) column (4) more narrow, hide 'sorting'
      // toggle. Sorting by commit hash is not needed, in particular because
      // one can filter by commit hash via input field. Do the same for the
      // "Commit author" column (1), and the "Commit message" columnn (5).
      // First column has index 0.
      "columnDefs": [{ "orderable": false, "targets": [1, 4, 5] }],
      "language": {
          "searchPlaceholder": "search across all columns",
      },
});


enable_search_query_string('#runs');

/* specify the HTML table id (string) for
 which search functionality should be enabled
*/
column_search_implementation('#runs');

</script>
{% endblock %}
