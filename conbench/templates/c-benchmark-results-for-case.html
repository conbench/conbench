{% extends "app.html" %}
{% block app_content %}

<div>
<!--
<h1 class="display-4">Results</h1>
<h2>Results</h2>
-->
<p class="fs-4">
<strong>{{ benchmark_name }}</strong> <br>
Results for <code>{{ case.text_id }}</code>
</p>

<!--<h1>Results for</h1>
<ul>
    <li>Benchmark name: <code>{{ benchmark_name }}</code></li>
    <li>Case: <code>{{ case.text_id }}</code></li>
</ul>
<p>Found {{ benchmark_result_count }} result(s).</p>
-->
<div class="mt-5">
<table class="table table-hover conbench-datatable" style="width:100%; display: none">
<thead>
    <tr>
        <th scope="col" style="width: 25%">time</th>
        <th scope="col">result</th>
        <th scope="col">hardware</th>
        <th scope="col">ctx id</th>
        <th scope="col" style="width: 10%"># samples</th>
        <th scope="col" style="width: 20%">data</th>
        <th scope="col" style="width: 10%">
            rel err
            <i class="bi bi-info-circle" data-bs-toggle="tooltip"
                data-bs-title="
                Relative standard error: standard error
                of the mean in relationship to the mean value. Only built
                when at least three samples are reported by this result.
                ">
            </i>
        </th>
    </tr>
</thead>
<tbody>
{% for result in benchmark_results %}
<tr>
    <td class="font-monospace">{{ result.ui_timestamp }}</td>
    <td class="font-monospace">
        <a href="{{ url_for('app.benchmark-result', benchmark_result_id=result.id) }}">{{ result.id [:9]}}</a>
    </td>
    <td class="font-monospace">{{ result.ui_hardware_short }}</td>
    <td class="font-monospace">{{ result.context.id[:7] }}</td>
    <td class="font-monospace">{{ result.ui_non_null_sample_count }}</td>
    <td class="font-monospace">{{ result.ui_mean_and_uncertainty }}</td>
    <td class="font-monospace">{{ result.ui_rel_sem }}</td>
</tr>
{% endfor %}
</tbody>
</table>
</div>


<div class="mt-5">
    <table class="table table-hover conbench-datatable foob" style="width:100%; display: none">
    <thead>
        <tr>
            <th scope="col" style="width: 15%">hw/ctx</th>
            <th scope="col" style="width: 25%">samples</th>
            <th scope="col" style="width: 500px">evolution</th>
        </tr>
    </thead>
    <tbody>
    {% for hwctx, results in results_by_hardware_and_contexts.items() %}
    <tr>
        <td class="font-monospace">{{ hwctx }}</td>
        <td class="font-monospace">
            {{ results|length}} results
        </td>
        <td>
            <div class="cb-plot-{{ hwctx }}" style="width: 500px"></div>
        </td>
    </tr>
    {% endfor %}
    </tbody>
    </table>
</div>


{% endblock %}

{% block scripts %}
{{super()}}
<script type="text/javascript">

// let data = [
//   [1546300800, 1546387200],    // x-values (timestamps)
//   [        35,         71],    // y-values (series 1)
//   [        90,         15],    // y-values (series 2)
// ];


let data_by_hwctx = {{ datas_for_plot_json|safe}};



$(document).ready(function () {
    let plotopts = {
        title: "",
        class: "cb-uplot",
        width: 400,
        height: 500,
        series: [
            {},
            {
            sorted: 0,
            show: true,
            spanGaps: false,
            //value: (self, rawValue) => "$" + rawValue.toFixed(5),
            stroke: "red",
            //width: 1,
            //fill: "rgba(255, 0, 0, 0.3)",
            //dash: [10, 5],
            scale: "s",
            points: {
                fill: 'black',
                size: 8,
                }
            }
        ],
        axes: [
            {},
            {
            show: true,
            label: "Population",
            labelSize: 30,
            labelFont: "bold 12px Arial",
            font: "12px Arial",
            gap: 5,
            size: 50,
            stroke: "red",
            grid: {
                show: true,
                stroke: "#eee",
                width: 2,
                dash: [],
            },
            ticks: {
                show: true,
                stroke: "#eee",
                width: 2,
                dash: [],
                size: 10,
            }
            }
        ],
        scales: {
            "s": {
                //auto: false,
                range:  {
                    min: {
                        pad: 0.2,
                        soft: 0,
                        mode: 1,
                    },
                    max: {
                        pad: 0.5,
                        soft: 0,
                        mode: 1,
                    },
                }
            }
        },
    };

    // $('table.conbench-datatable').each(function() {
    //     let uplot = new uPlot(plotopts["{{ data_by_hwctx }}"], data, $(this));
    // });
    // use jquery selector, but then get raw element with [0]
    {% for hwctx, results in results_by_hardware_and_contexts.items() %}

        let uplot_{{ hwctx }} = new uPlot(plotopts, data_by_hwctx["{{ hwctx }}"], $('.cb-plot-{{ hwctx }}')[0]);
    {% endfor %}

    // Enable bootstrap tooltips on this page.
    const tooltipTriggerList = document.querySelectorAll('[data-bs-toggle="tooltip"]');
    const tooltipList = [...tooltipTriggerList].map(tooltipTriggerEl => new bootstrap.Tooltip(tooltipTriggerEl));

    $('table.conbench-datatable').each(function() {
        $(this).DataTable({
            // Note(JP): this enables a special, simple plugin called
            // `conditionalPaging` which must be included, e.g. via the dist URLs
            // published in https://cdn.datatables.net/plug-ins/1.13.3/features/.
            // kudos to https://stackoverflow.com/a/29639664/145400
            "conditionalPaging": true,
            "responsive": true,
            // the default default seems to be the first item in lengthMenu.
            "lengthMenu": [ 5, 10, 50, 75, 100, 250, 750 ],
            // but when pageLength is also set, then _this_ is the default.
            "pageLength": 50,
            // Take rather precise control of layouting elements, put bottom elements
            // into a mult-col single row, using BS's grid system.
            "dom": 'lfrt<"row"<"col-6"i><".col-6"p>>',
            "order": [[0, 'desc']],
            "columnDefs": [{ "orderable": true }],
            initComplete: function () {
                var api = this.api();
                // reveal only after DOM modification is complete (reduce loading
                // layout shift artifacts)
                $('table.conbench-datatable').show();
                api.columns.adjust();
                $('.pagination').addClass('pagination-sm'); // add BS class for smaller pagination bar
            },
        });
    });
});
</script>
{% endblock %}











